#!/usr/bin/env ruby

# Recreate GitLab hooks in the Git repositories managed by GitLab.
#
# This script is used when restoring a GitLab backup.

$:.unshift File.expand_path('../lib', __FILE__)
require 'gitlab_init'
require 'gitlab_projects'

Dir["#{GitlabConfig.new.repos_path}/*/*.git"].each do |repo|
  begin
    GitlabProjects.create_hooks(repo)
  rescue Errno::ENOENT
    # The user must have deleted their repository. Ignore.
  end
end
